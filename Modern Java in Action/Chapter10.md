# Chap10. 람다를 이용한 도메인 전용 언어

도메인 전용 언어(DSL)로 애플리케이션의 비즈니스 로직을 표현

- DSL은 작은, 범용이 아니라 특정 도메인을 대상으로 만들어진 특수 프로그래밍 언어
- 메이븐, 앤트 등이 빌드 과정을 표현하는 DSL에 해당

**플루언트 스타일:** 스트림의 API의 특성인 메서드 체인을 보통 자바의 루프의 복잡한 제어와 비교해 유창함을 의미

- DSL을 만들려면 애플리케이션 수준 프로그래머에 어떤 동작이 필요하며 이들을 어떻게 프로그래머에게 제공하는지 고민이 필요
- **내부적 DSL**에서는 유창하게 코드를 구현할 수 있도록 적절하게 클래스와 메서드를 노출하는 과정 필요
- **외부적 DSL**은 DSL 문법 뿐 아니라 DSL을 평가하는 파서도 구현

## 10.1 도메인 전용 언어

- DSL은 특정 비즈니스 도메인의 문제를 해결하려고 만든 언어
- 범용 프로그래밍 언어가 아님
- DSL을 이용하면 사용자가 특정 도메인의 복잡성을 더 잘 다룰 수 있음
- DSL을 개발할 때 필요한 두가지
    1. **의사 소통의 왕**: 코드의 의도가 명확히 전달, 일반인도 이해 가능해야 함
    2. **한 번 코드를 구현하지만 여러 번 읽는다**

### DSL의 장점과 단점

- DSL을 도메인에 이용하면 약이 되거나 독이 될 수 있음
- **장점**: 코드의 비즈니스 의도를 명확하게 하고 가독성을 높임
- **단점**: DSL 구현은 코드이므로 올바로 검증하고 유지보수해야 하는 책임

<aside>
💡 ※ DSL이 제공하는 장점 ※
간결함, 가독성, 유지보수, 높은 수준의 추상화, 집중, 관심사분리

※ DSL로 인한 단점 ※
DSL 설계의 어려움, 개발 비용, 추가 우회 계층, 새로 배워야 하는 언어, 호스팅 언어 한계

</aside>

### JVM에서 이용할 수 있는 다른 DSL 해결책

- DSL의 카테고리를 구분하는 가장 흔한 방법 = **내부 DSL과 외부 DSL을 나누는 것**
- 내부 DSL(임베디드 DSL)
    - 순수 자바 코드같은 기존 호스팅 언어를 기반으로 구현
    
    **순수 자바로 DSL을 구현함으로써 얻는 장점**
    
    - 외부 DSL에 비해 새로운 패턴과 기술을 배울 노력이 현저하게 줄어듦
    - 순수 자바로 DSL을 구현하면 나머지 코드와 함께 DSL 컴파일 가능
        
        → 다른 언어의 컴파일러 or 외부 DSL을 사용하지 않아 자원을 아낌
        
    - 새로운 언어를 배우거나 익숙하지 않은 복잡한 외부 도구를 배울 필요X
    - 기존의 자바 IDE를 이용해 자동 완성, 리팩터링 같은 기능 그대로 사용
    - 한 개의 언어로 1~n 개의 도메인을 대응하지 못해 추가로 DSL을 개발해야 하는 상황에서 자바를 이용하면 추가 DSL을 쉽게 합칠 수 있음
- 외부 DSL
    - 호스팅 언어와는 독립적으로 자체의 문법을 가짐
    - 외부 DSL을 개발하는 가장 큰 장점은 외부 DSL이 제공하는 무한한 유연성
        
        → 우리에게 필요한 특성을 완벽하게 제공하는 언어 설계 가능
        
    - 자바로 개발된 인프라구조 코드와 외부 DSL로 구현한 비즈니스 코드를 명확하게 분리한다는 것도 장점이지만 이러한 분리로 인해 DSL과 호스트 언어 사이에 인공 계층이 생김

**다중 DSL**

- 스칼라, 루비와 같이 자바보다 젊으며 제약을 줄이고, 간편한 문법을 지향하도록 설계된 언어들의 특성은 간결한 DSL을 만드는 데 매우 중요 → 자바보다 더 친화적인 DSL 구현 가능

## 10.2 최신 자바 API의 작은 DSL

`Comparator` 인터페이스의 compare(), `List` 인터페이스의 sort() 과 같이 이러한 작은 API는 최소 DSL이라고 한다.

### 스트림 API는 컬렉션을 조작하는 DSL

- **`Stream`** 인터페이스는 네이티브 자바 API에 작은 내부 DSL을 적용한 좋은 예
- Stream은 컬렉션의 항목을 필터, 정렬, 변환, 그룹화, 조작하는 작지만 강력한 DSL
- 스트림 API의 플루언트 형식은 잘 설계된 DSL의 또 다른 특징
    - 모든 중간 연산은 게으르며 다른 연산으로 파이프라인될 수 있는 스트림으로 반환
    - 최종 연산은 적극적이며 전체 파이프라인이 계산을 일으킴

### 데이터를 수집하는 DSL인 Collectors

- **`Collector`** 인터페이스는 데이터 수집을 수행하는 DSL

## 10.3 자바로 DSL을 만드는 패턴과 기법

- DSL은 특정 도메인 모델에 적용할 친화적이고 가독성 높은 API 제공

```java
// 예제 도메인 모델은 세 가지로 구성

// 1. 주식 가격을 모델링하는 Stock 클래스(생성자 getter & setter 포함)
// 2. 주식을 사거나 파는 Trade 클래스(생성자 getter & setter 포함)
// 3. 고객이 요청한 한 개 이상의 거래인 Order 클래스(생성자 getter & setter 포함)

// 도메인 객체의 API를 직접 이용해 주식 거래를 만듦(코드 생략)
//	-> 상당히 장황한 코드, 비 개발자인 도메인 전문가가 이해하고 검증하기 힘듦

// 메서드 체인으로 주식 거래 주문을 만들어 도메인 전문가도 이해하기 쉬운 코드로 변환
Order order = forCustomer("BigBank")
		.buy(80)
		.stock("IBM")
		.on("NYSE")
		.at(125.00)
		.sell(50)
		.stock("GOOGLE")
		.on("NASDAQ")
		.at(375.00)
		.end();

// 위와 같은 체인(혹은 중첩 함수, 람다를 이용한 함수 시퀀싱)을 
// 만드려면 어떻게 코드를 작성해야하는지는 p.340 ~ p.352 확인하기
// 코드가 너무 많아요....
```

![10_1](https://github.com/znight1020/Reading-Development-Book/assets/104980470/04cd0a7c-eddf-4521-bdd8-c94049d59fd3)

## 10.5 마치며

- DSL의 주요 기능은 개발자와 도메인 전문가 사이의 간격을 좁히기 위함
- 개발자가 아닌 사람도 이해할 수 있는 언어로 이런 비즈니스 로직을 구현할 수 있다고 해서 프로그래머가 되는 건 아니지만 적어도 로직을 읽고 검증하는 역할을 할 수 있음
- DSL은 크게 **내부적**(DSL이 사용될 애플리케이션을 개발한 언어를 그대로 활용), **외부적**(직접 언어를 설계해 사용함) DSL로 분류
- JVM에서 이용할 수 있는 스칼라, 그루비 등 다른 언어로 다중 DSL 개발 가능
- 자바의 장황함과 문법적 엄격함으로 인해 DSL 개발 언어로 적합하지 않았지만 자바 8의 람다 표현식과 메서드 참조 덕분에 상황이 많이 개선
